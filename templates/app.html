{% extends "base.html" %}

{% block css %}
{{ super() }}
<style>
.sketchy-border {
    border-radius: 25px 25px 55px 5px/5px 55px 25px 25px; 
    border: 1.2px solid #6b6b6b;
}
.no-visited:visited {
    color: inherit;
}
.clickable-icon {
    cursor: pointer;
}
#grip {
    cursor: move; /* Change cursor to indicate movability */
}

.alert {
    transition: opacity 1s ease-out, height 1s ease-out, padding 1s ease-out, margin 1s ease-out;
    opacity: 1; /* Initial opacity */
    overflow: hidden; /* Prevent content from spilling during height transition */
}

.modal-content {
    border-radius: 1rem;
    border: 1px solid var(--bs-border-color);
    background-color: var(--bs-body-bg);
    box-shadow: 0 0.75rem 2rem rgba(33, 37, 41, 0.2);
}

.modal-header {
    border-bottom: 1px solid var(--bs-border-color);
}

.modal-footer {
    border-top: 1px solid var(--bs-border-color);
}

.modal-title {
    font-weight: 600;
}

</style>
{% endblock css %}


{% block scripts %}
    {{ super() }}

<script>
    window.displayFlashMessage = function(message, type = 'info') {
        const flashContainer = document.getElementById('flash-container');
        const target = flashContainer || document.body;
        const alert = document.createElement('div');
        alert.className = `alert alert-${type} alert-dismissible fade show mt-2`;
        alert.setAttribute('role', 'alert');
        alert.innerHTML = `
            <div class="d-flex align-items-center gap-2">
                <span>${message}</span>
                <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;

        if (target.firstChild) {
            target.insertBefore(alert, target.firstChild);
        } else {
            target.appendChild(alert);
        }

        if (type === 'success' || type === 'info') {
            window.setTimeout(() => {
                const instance = bootstrap.Alert.getOrCreateInstance(alert);
                instance.close();
            }, 5000);
        }
    };

    function expandAccordionItem(accordionItemId) {
        var toggleElement = document.querySelector(`[data-bs-target="#${accordionItemId}"]`);
        if (toggleElement && toggleElement.classList.contains('collapsed')) {
            toggleElement.click();
        }
    }


    function collapseAccordionItem(accordionItemId) {
        var toggleElement = document.querySelector(`[data-bs-target="#${accordionItemId}"]`);
        if (toggleElement && !toggleElement.classList.contains('collapsed')) {
            toggleElement.click();
        }
    }


    function initializeSortable(listId, itemType) {
        var el = document.getElementById(listId);

        if (!el) return; // Exit if element is not found

        var sortable = Sortable.create(el, {
            handle: "#grip", // Only allow drag using the grip icon
            onEnd: function () {
                updateRank(listId, itemType); // Pass accordionId and itemType
            },
        });
    }

    function updateRank(listId, itemType) {
        var orderedIds = [];
        document.querySelectorAll(`#${listId} #grip`)
            .forEach(function (item, index) {
                orderedIds.push({
                    id: item.getAttribute("data-item-id"),
                    newRank: index + 1, // Assuming rank starts at 1
                });
            });

        fetch(`/${itemType}/rank`, { // Use the itemType in the URL
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": document.getElementById("csrf_token").value, // Include CSRF token
            },
            body: JSON.stringify({ items: orderedIds }),
        })
        .then((response) => response.json())
        .then((data) => {
            if (data.success) {
                // Rank updated successfully - no logging needed
            }
        })
        .catch((error) => console.error("Error:", error));
    }

</script>
{% endblock %}
