<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalTitle">Confirm action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-1 fw-semibold" id="confirmationModalMessage">Are you sure you want to proceed?</p>
                <p class="text-muted small mb-3" id="confirmationModalDescription">Review the details below before continuing.</p>
                <ul class="text-muted small mb-0 ps-3 d-none" id="confirmationModalDetails"></ul>
            </div>
            <div class="modal-footer gap-2">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmButton">Confirm</button>
            </div>
        </div>
    </div>
</div>

<script>
(() => {
    const modalElement = document.getElementById('confirmationModal');
    if (!modalElement) {
        return;
    }

    const modalTitle = document.getElementById('confirmationModalTitle');
    const modalMessage = document.getElementById('confirmationModalMessage');
    const modalDescription = document.getElementById('confirmationModalDescription');
    const modalDetails = document.getElementById('confirmationModalDetails');
    const confirmButton = document.getElementById('confirmButton');
    let modalInstance = null;
    let resolver = null;
    let wasConfirmed = false;
    const defaultConfirmClass = 'btn btn-danger';
    const defaultMessage = 'Are you sure you want to proceed?';
    const defaultDescription = 'Review the details below before continuing.';

    confirmButton.addEventListener('click', () => {
        wasConfirmed = true;
        const instance = ensureModalInstance();
        if (instance) {
            instance.hide();
        } else {
            wasConfirmed = false;
        }
    });

    modalElement.addEventListener('hidden.bs.modal', () => {
        if (typeof resolver === 'function') {
            resolver(wasConfirmed);
        }
        wasConfirmed = false;
        resolver = null;
        confirmButton.className = defaultConfirmClass;
        confirmButton.textContent = 'Confirm';
        if (modalMessage) {
            modalMessage.textContent = defaultMessage;
        }
        if (modalDescription) {
            modalDescription.textContent = defaultDescription;
            modalDescription.classList.remove('d-none');
        }
        if (modalDetails) {
            modalDetails.innerHTML = '';
            modalDetails.classList.add('d-none');
        }
    });

    function ensureModalInstance() {
        if (modalInstance) {
            return modalInstance;
        }
        if (typeof bootstrap === 'undefined' || !bootstrap.Modal) {
            console.warn('Confirmation modal requires Bootstrap.');
            return null;
        }
        modalInstance = new bootstrap.Modal(modalElement);
        return modalInstance;
    }

    window.showConfirmationModal = function showConfirmationModal({
        title = 'Confirm action',
        message = defaultMessage,
        description = defaultDescription,
        details = [],
        confirmLabel = 'Confirm',
        confirmVariant = 'danger',
    } = {}) {
        if (modalTitle) {
            modalTitle.textContent = title;
        }
        if (modalMessage) {
            modalMessage.textContent = message;
        }
        if (modalDescription) {
            const hasDescription = typeof description === 'string' && description.trim().length > 0;
            modalDescription.textContent = hasDescription ? description : '';
            modalDescription.classList.toggle('d-none', !hasDescription);
        }
        if (modalDetails) {
            modalDetails.innerHTML = '';
            const normalizedDetails = Array.isArray(details)
                ? details.filter((detail) => typeof detail === 'string' && detail.trim().length > 0)
                : [];
            if (normalizedDetails.length > 0) {
                normalizedDetails.forEach((detail) => {
                    const item = document.createElement('li');
                    item.textContent = detail;
                    modalDetails.appendChild(item);
                });
                modalDetails.classList.remove('d-none');
            } else {
                modalDetails.classList.add('d-none');
            }
        }
        if (confirmButton) {
            const normalizedVariant = (confirmVariant || 'danger').trim();
            if (normalizedVariant.startsWith('btn')) {
                confirmButton.className = normalizedVariant;
            } else if (normalizedVariant.includes(' ')) {
                confirmButton.className = `btn ${normalizedVariant}`;
            } else {
                confirmButton.className = `btn btn-${normalizedVariant}`;
            }
            confirmButton.textContent = confirmLabel;
        }

        const instance = ensureModalInstance();
        if (!instance) {
            return Promise.resolve(false);
        }
        instance.show();
        return new Promise((resolve) => {
            resolver = resolve;
        });
    };
})();
</script>
